# QR 코드 갤러리 기능 추가

## 작업 목적 및 배경

attend 애플리케이션에서 QR 코드 인식 기능을 개선하기 위한 작업이 진행되었습니다. 기존에는 카메라로만 QR 코드를 인식할 수 있었으나, 사용자의 편의성을 위해 갤러리에서 이미지를 선택하여 QR 코드를 인식할 수 있는 기능이 필요했습니다.

## 문제점 및 해결 방법

### 1. 갤러리 이미지 로드 기능 추가

- 갤러리에서 이미지를 선택할 수 있는 input 요소와 버튼을 추가했습니다.
- 파일 선택 시 이미지를 미리보기로 표시하고 QR 코드 영역을 선택할 수 있는 UI를 구현했습니다.

### 2. 이미지 크롭 기능 구현

- 사용자가 QR 코드 영역을 정확하게 지정할 수 있도록 드래그 및 리사이즈가 가능한 크롭 오버레이를 구현했습니다.
- 데스크톱(마우스)과 모바일(터치) 환경을 모두 지원하도록 이벤트 핸들러를 설계했습니다.
- 영역을 조정한 후 자동으로 QR 코드 인식을 시도하는 자동화 기능을 추가했습니다.

### 3. 화질 저하 문제

- 이미지 크롭 시 화질이 저하되는 문제가 발생했습니다.
- 캔버스 크기 제한이 주요 원인으로 파악되었으며, 원본 이미지의 해상도를 고려한 스케일링 계산이 필요했습니다.

### 4. 모바일 환경 최적화

- 모바일 기기에서 터치 이벤트 처리를 개선했습니다.
- 크롭 영역 조작을 위한 핸들의 크기를 확대하여 모바일 환경에서의 사용성을 향상시켰습니다.
- 스크롤 중 발생할 수 있는 오프셋 문제를 해결했습니다.

## 구현 세부 사항

1. **파일 선택 및 로드**
   - `<input type="file">` 요소와 커스텀 버튼을 연결하여 갤러리 접근 UI 개선
   - FileReader API를 사용하여 선택된 이미지 미리보기 제공

2. **크롭 인터페이스**
   - 절대 위치 지정을 통한 이미지 위에 크롭 오버레이 표시
   - 4개의 모서리 핸들을 통한 리사이즈 기능 구현
   - 드래그를 통한 크롭 영역 이동 기능 구현

3. **이벤트 처리**
   - 마우스 이벤트(mousedown, mousemove, mouseup)와 터치 이벤트(touchstart, touchmove, touchend) 통합 처리
   - 영역 변경 후 타임아웃을 통한 자동 스캔 기능 구현(500ms 대기)

4. **이미지 처리**
   - Canvas API를 사용하여 선택한 영역만 추출하는 기능 구현
   - 원본 이미지와 표시된 이미지 간의 비율을 계산하여 정확한 크롭 좌표 계산
   - 크롭된 이미지를 Blob 객체로 변환하여 QR 코드 인식 기능에 전달

5. **사용자 피드백**
   - 스캔 과정과 결과에 대한 메시지 표시
   - 스캔 실패 시 영역 조정 안내 메시지 제공

## 고려한 대안

1. **서버 측 처리**
   - 전체 이미지를 서버로 전송하여 서버 측에서 QR 코드 인식을 처리하는 방법
   - 장점: 클라이언트 리소스 절약, 더 강력한 인식 알고리즘 사용 가능
   - 단점: 서버 부하 증가, 네트워크 트래픽 증가, 개인 정보 보호 문제
   - 결정: 클라이언트 측 처리 방식 채택 (오프라인 사용성, 즉각적인 응답 등의 이점)

2. **자동 QR 코드 감지**
   - 이미지에서 자동으로 QR 코드를 감지하여 영역을 선택하는 방법
   - 장점: 사용자 편의성 증가
   - 단점: 구현 복잡도 증가, 오탐지 가능성
   - 결정: 수동 영역 선택 방식 채택 (신뢰성 및 구현 용이성)

3. **이미지 품질 향상 기법**
   - 이미지 처리 라이브러리를 사용하여 QR 코드 인식률 향상
   - 장점: 인식률 향상 가능
   - 단점: 의존성 증가, 애플리케이션 크기 증가
   - 결정: 기본 HTML5 Canvas API 사용 (간결성 및 성능 고려)

## 남은 과제

1. **화질 개선**
   - 캔버스 크기 제한 문제 해결을 위한 추가 개선 필요
   - 디바이스 픽셀 비율을 고려한 스케일링 계산 구현

2. **모바일 크롭 정확도**
   - 모바일 환경에서 크롭 오프셋 문제 해결을 위한 추가 개선 필요
   - 터치 이벤트 처리 시 상대 좌표 계산 방식 개선

3. **다양한 환경 테스트**
   - 다양한 모바일 기기와 브라우저에서의 동작 확인 필요
   - 저사양 기기에서의 성능 최적화 고려

4. **접근성 개선**
   - 스크린 리더 지원 등 접근성 기능 향상 필요
   - 키보드 네비게이션 지원 추가 고려
